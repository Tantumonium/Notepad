data:text/html,<html>
<head>
    <title>Notes</title>
    <style>
*%20%7B%0A%20%20%20%20box-sizing%3A%20border-box%3B%0A%20%20%20%20margin%3A%200%3B%0A%20%20%20%20padding%3A%200%3B%0A%7D%0A%0Abody%20%7B%0A%20%20%20%20font-family%3A%20sans-serif%3B%0A%20%20%20%20background-color%3A%20%23fbfbfb%3B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20flex-direction%3A%20column%3B%0A%20%20%20%20height%3A%20100vh%3B%0A%20%20%20%20overflow%3A%20hidden%3B%0A%7D%0A%0A.top-pane%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20justify-content%3A%20space-between%3B%0A%20%20%20%20align-items%3A%20center%3B%0A%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20border-bottom%3A%201px%20solid%20%23ccc%3B%0A%7D%0A%0A%23entry-title%20%7B%0A%20%20%20%20flex-grow%3A%201%3B%0A%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20font-size%3A%201rem%3B%0A%20%20%20%20border%3A%201px%20solid%20%23ccc%3B%0A%20%20%20%20border-radius%3A%204px%3B%20%0A%7D%0A%0A.button-bar%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%7D%0A.button-container%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20align-items%3A%20center%3B%0A%7D%0A%0A.move-btn%2C%20.delete-btn%20%7B%0A%20%20%20%20margin-left%3A%205px%3B%0A%20%20%20%20background%3A%20none%3B%0A%20%20%20%20border%3A%20none%3B%0A%20%20%20%20cursor%3A%20pointer%3B%0A%7D%0A.color-picker%20%7B%0A%20%20%20%20position%3A%20fixed%3B%0A%20%20%20%20top%3A%2050%25%3B%0A%20%20%20%20left%3A%2050%25%3B%0A%20%20%20%20transform%3A%20translate(-50%25%2C%20-50%25)%3B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20flex-wrap%3A%20wrap%3B%0A%20%20%20%20background-color%3A%20%23fff%3B%0A%20%20%20%20border%3A%201px%20solid%20%23ccc%3B%0A%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20z-index%3A%201000%3B%0A%7D%0A%0A.color-option%20%7B%0A%20%20%20%20width%3A%2030px%3B%0A%20%20%20%20height%3A%2030px%3B%0A%20%20%20%20margin%3A%205px%3B%0A%20%20%20%20cursor%3A%20pointer%3B%0A%7D%0A%0A%0A.color-btn%20%7B%0A%20%20%20%20margin-left%3A%205px%3B%0A%20%20%20%20background%3A%20none%3B%0A%20%20%20%20border%3A%20none%3B%0A%20%20%20%20cursor%3A%20pointer%3B%0A%7D%0A%0A%0A.button-bar%20button%20%7B%0A%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20font-size%3A%201rem%3B%0A%20%20%20%20margin-left%3A%2010px%3B%0A%20%20%20%20background-color%3A%20%23333%3B%0A%20%20%20%20color%3A%20%23fff%3B%0A%20%20%20%20border%3A%20none%3B%0A%20%20%20%20border-radius%3A%205px%3B%20%0A%7D%0A%0A.content-area%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20height%3A%20100%25%3B%0A%7D%0A%0A%23entry-list%20%7B%0A%20%20%20%20width%3A%2020%25%3B%0A%20%20%20%20max-width%3A%20200px%3B%0A%20%20%20%20overflow-y%3A%20auto%3B%0A%20%20%20%20border-right%3A%201px%20solid%20%23ccc%3B%0A%20%20%20%20padding%3A%2010px%3B%0A%7D%0A%23entry-content%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20flex-direction%3A%20row%3B%0A%20%20%20%20height%3A%20100%25%3B%0A%20%20%20%20width%3A%20100%25%3B%0A%7D%0A.entry-item%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20justify-content%3A%20space-between%3B%0A%20%20%20%20align-items%3A%20center%3B%0A%20%20%20%20padding%3A%205px%3B%0A%20%20%20%20border-bottom%3A%201px%20solid%20%23eee%3B%0A%7D%0A%0A.entry-item.active%20%7B%0A%20%20%20%20background-color%3A%20%23fff%3B%0A%20%20%20%20border%3A%202px%20solid%20%23333%3B%20%0A%20%20%20%20font-weight%3A%20bold%3B%20%0A%20%20%20%20border-radius%3A%204px%3B%20%0A%7D%0A%0A%23entry-content-storage%20%7B%0A%20%20%20%20display%3A%20none%3B%0A%7D%0A.move-btn%20%7B%0A%20%20%20%20background%3A%20none%3B%0A%20%20%20%20border%3A%20none%3B%0A%20%20%20%20cursor%3A%20pointer%3B%0A%20%20%20%20padding%3A%202px%205px%3B%0A%20%20%20%20font-size%3A%200.8rem%3B%0A%7D%0A%0A%0A.split-vertical%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20flex-direction%3A%20column%3B%0A%20%20%20%20height%3A%20100%25%3B%0A%7D%0A%0A.split-horizontal%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20height%3A%20100%25%3B%0A%7D%0A.split-vertical%20%3E%20.entry-pane%2C%0A.split-horizontal%20%3E%20.entry-pane%20%7B%0A%20%20%20%20flex%3A%201%3B%0A%7D%0A.move-btn%3Ahover%2C%20.delete-btn%3Ahover%2C%20.color-btn%3Ahover%2C%20.button-bar%20button%3Ahover%2C%20.entry-item%3Ahover%20%7B%0A%20%20%20%20background-color%3A%20%23eee%3B%20%0A%20%20%20%20cursor%3A%20pointer%3B%0A%7D%0A.pane-title%20%7B%0A%20%20%20%20background-color%3A%20%23f1f1f1%3B%0A%20%20%20%20padding%3A%205px%3B%0A%20%20%20%20border-bottom%3A%201px%20solid%20%23ccc%3B%0A%20%20%20%20font-weight%3A%20bold%3B%0A%7D%0A.entry-pane%20%7B%0A%20%20%20%20flex%3A%201%201%2050%25%3B%0A%20%20%20%20border%3A%201px%20solid%20%23ccc%3B%0A%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20margin%3A%205px%3B%0A%20%20%20%20overflow%3A%20auto%3B%0A%20%20%20%20box-sizing%3A%20border-box%3B%0A%20%20%20%20background-color%3A%20%23f9f9f9%3B%20%0A%20%20%20%20white-space%3A%20pre-wrap%3B%0A%7D%0A.entry-pane%20%3E%20div%5Bcontenteditable%3D%22true%22%5D%20%7B%0A%20%20%20%20width%3A%20100%25%3B%0A%20%20%20%20height%3A%20calc(100%25%20-%2030px)%3B%0A%20%20%20%20overflow%3A%20auto%3B%0A%20%20%20%20border%3A%20none%3B%0A%20%20%20%20padding%3A%205px%3B%0A%20%20%20%20line-height%3A%201.5%3B%0A%20%20%20%20resize%3A%20both%3B%0A%20%20%20%20font-size%3A%2014px%3B%0A%7D%0A%0A%3A%3A-webkit-scrollbar%20%7B%0A%20%20%20%20width%3A%2010px%3B%0A%7D%0A%3A%3A-webkit-scrollbar-thumb%20%7B%0A%20%20%20%20background%3A%20%23ccc%3B%0A%20%20%20%20border-radius%3A%205px%3B%0A%7D%0A%40media%20screen%20and%20(max-width%3A%20720px)%20%7B%0A%20%20%20%20.content-area%20%7B%0A%20%20%20%20%20%20%20%20flex-direction%3A%20column%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%23entry-list%20%7B%0A%20%20%20%20%20%20%20%20width%3A%20100%25%3B%0A%20%20%20%20%20%20%20%20height%3A%20auto%3B%0A%20%20%20%20%20%20%20%20border-right%3A%20none%3B%0A%20%20%20%20%20%20%20%20border-bottom%3A%201px%20solid%20%23ccc%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%23entry-content%20%7B%0A%20%20%20%20%20%20%20%20width%3A%20100%25%3B%0A%20%20%20%20%20%20%20%20height%3A%2060vh%3B%0A%20%20%20%20%7D%0A%20.entry-pane%20%7B%0A%20%20%20%20%20%20%20%20padding%3A%2010px%3B%0A%20%20%20%20%20%20%20%20margin%3A%203px%3B%0A%20%20%20%20%7D%0A%7D%0A%0A%0A
    </style>
</head>
<body>
    <div class="top-pane">
        <input id="entry-title" type="text" placeholder="Create new entry here...">
        <div class="button-bar">
            <button id="save-button" type="button">Save as txt file</button>
            <button id="save-db-button" type="button">Save Database</button>
            <button id="load-db-button" type="button">Load Database</button>
        </div>
    </div>
    <div class="content-area">
        <div id="entry-list"></div>
        <div id="entry-content"></div> 
    </div>
    <textarea id="entry-content-storage"></textarea>
    <input id="file-input" type="file" style="display: none;">
    <script type="text/javascript">

        function changeFavicon(url) {
            var link = document.createElement('link'),
                oldLink = document.querySelector('link[rel="shortcut icon"]') || document.querySelector('link[rel="icon"]');
            link.rel = 'shortcut icon';
            link.href = url;
        
            if (oldLink) {
                document.head.removeChild(oldLink);
            }
            document.head.appendChild(link);
        }
        var faviconUrl = 'https://reticulated.net/favicon/favicon.ico';
        changeFavicon(faviconUrl);
        var entryTitle = document.getElementById("entry-title"),
            entryList = document.getElementById("entry-list"),
            entryContent = document.getElementById("entry-content"),
            entryContentStorage = document.getElementById("entry-content-storage"),
            saveDbButton = document.getElementById("save-db-button"),
            loadDbButton = document.getElementById("load-db-button"),
            saveButton = document.getElementById("save-button"),
            fileInput = document.getElementById("file-input"),
            entries = [],
            current = -1;

        function loadEntries() {
            var storedEntries = entryContentStorage.value;
            if (storedEntries) {
                try {
                    entries = JSON.parse(storedEntries);
                    updateEntryList();
                    if (entries.length > 0) {
                        current = 0;
                        updateEntryContent();
                    }
                } catch (e) {
                    console.error('Error parsing entries:', e);
                }
            }
        }

        function saveEntries() {
            entryContentStorage.value = JSON.stringify(entries);
        }

      
        function savePaneContent() {
            var allPanes = entryContent.querySelectorAll('.entry-pane');
            allPanes.forEach(pane => {
                var entryId = pane.dataset.entryId;
                var contentDiv = pane.querySelector('div[contenteditable="true"]');
                if (contentDiv && entryId !== undefined) {
                    var entryIndex = parseInt(entryId);
                    if (entries[entryIndex]) {
                        entries[entryIndex].content = contentDiv.innerHTML;
                    }
                }
            });
            saveEntries();
        }
        
        
        
        function addNewEntry(title) {
            var newEntry = { id: entries.length, title: title, content: "" };
            entries.push(newEntry);
            return newEntry;
        }

        function reorderEntries(sourceIndex, targetIndex) {
            if (sourceIndex === targetIndex) return;
            const movedItem = entries.splice(sourceIndex, 1)[0];
            entries.splice(targetIndex, 0, movedItem);
            updateEntryList();
            saveEntries();
        }
        
        
        function updateEntryList() {
            entryList.innerHTML = "";
            entries.forEach(function(entry, index) {
                var e = document.createElement("div");
                e.className = "entry-item";
                e.setAttribute('data-index', index.toString());
                e.draggable = true;
                e.ondragstart = function(event) {
                    event.dataTransfer.setData("text/plain", index);
                };
                e.ondragover = function(event) {
                    event.preventDefault();
                };
                e.ondrop = function(event) {
                    event.preventDefault();
                    var sourceIndex = event.dataTransfer.getData("text/plain");
                    var targetIndex = index;
                    reorderEntries(sourceIndex, targetIndex);
                };        
                var textSpan = document.createElement("span");
                textSpan.textContent = entry.title;
                
                e.ondblclick = function(event) {
                    var newName = prompt("Enter a new name for this entry:", entry.title);
                    if (newName && newName !== entry.title) {
                        entry.title = newName;
                        updateEntryList();
                        saveEntries();
                    }
                };        
                e.appendChild(textSpan);
            
                var deleteBtn = document.createElement("button");
                deleteBtn.textContent = "X";
                deleteBtn.className = "delete-btn";
                deleteBtn.onclick = function(event) {
                    event.stopPropagation();
                    if (confirm("Are you sure you want to delete this note?")) { 
                        entries.splice(index, 1);
                        if (current === index) {
                            current = -1;
                            entryContent.classList.remove('active');
                        }
                        updateEntryList();
                        updateEntryContent();
                        saveEntries();
                    }
                };

                var colorBtn = document.createElement("button");
                colorBtn.textContent = "🎨";
                colorBtn.className = "color-btn";
                colorBtn.onclick = function(event) {
                    event.stopPropagation();
                    showColorPicker(e, entry);
                };
                            
            

                var buttonContainer = document.createElement("div");
                buttonContainer.className = "button-container";
                buttonContainer.appendChild(colorBtn);
                buttonContainer.appendChild(deleteBtn);
                
            
                e.appendChild(buttonContainer);
            
                if (index === current) {
                    e.classList.add("active");
                    entryContent.classList.add('active');
                }

                if (entry.color && entry.color !== 'none') {
                    updateEntryColor(e, entry.color);
                }
            
                e.onclick = function() {
                    current = index;
                    clearAndLoadEntry(entries[index]);
                    updateEntryContent();
                    updateEntryList();
                };

                entryList.appendChild(e);
            });
        }

        function updateEntryColor(entryElement, color) {
            var styles = colorStyles[color];
            if (styles) {
                entryElement.style.backgroundColor = styles.backgroundColor;
                entryElement.style.color = styles.color;
                var pane = entryContent.querySelector(`[data-entry-id='${entryElement.dataset.index}']`);
                if (pane) {
                    var titleBar = pane.querySelector('.pane-title');
                    titleBar.style.backgroundColor = styles.backgroundColor;
                    titleBar.style.color = styles.color;
                }
            }
        }
        

        function showColorPicker(entryElement, entry, isBackground) {
            var colorPicker = document.createElement("div");
            colorPicker.className = "color-picker";
        
            var colors = ['red', 'blue', 'green', 'yellow', 'orange', 'purple', 'pink', 'brown', 'grey', 'black', 'white'];
            colors.forEach(function(color) {
                var colorOption = document.createElement("div");
                colorOption.className = "color-option";
                colorOption.style.backgroundColor = colorStyles[color].backgroundColor;
                colorOption.onclick = function() {
                    updateEntryColor(entryElement, color);
                    entry.color = color;
                    saveEntries();
                    document.body.removeChild(colorPicker);
                };
                colorPicker.appendChild(colorOption);
                colorOption.onclick = function() {
                    if (isBackground) {
                        entryElement.style.backgroundColor = colorStyles[color].backgroundColor;
                        entry.contentBackgroundColor = colorStyles[color].backgroundColor;
                    } else {
                        updateEntryColor(entryElement, color);
                    }
                    saveEntries();
                    document.body.removeChild(colorPicker);
                };
                        });
        
            document.body.appendChild(colorPicker);
        }
        
        var colorStyles = {
            red: { backgroundColor: '%23ffcccc', color: 'black' },
            blue: { backgroundColor: '%23cceeff', color: 'black' },
            green: { backgroundColor: '%23ccffcc', color: 'black' },
            yellow: { backgroundColor: '%23ffff99', color: 'black' },
            orange: { backgroundColor: '%23ffcc99', color: 'black' },
            purple: { backgroundColor: '%23e6ccff', color: 'black' },
            pink: { backgroundColor: '%23ffccff', color: 'black' },
            brown: { backgroundColor: '%23d2b48c', color: 'black' },
            grey: { backgroundColor: '%23cccccc', color: 'black' },
            black: { backgroundColor: '%23000000', color: 'white' },
            white: { backgroundColor: '%23ffffff', color: 'black' }
        };

        function reorderPanes(sourcePane, targetPane) {
            if (!sourcePane || !targetPane || sourcePane === targetPane) {
                return;
            }
        
            var parentContainer = targetPane.parentNode;
            var temp = document.createElement("div");
            parentContainer.insertBefore(temp, targetPane);
            parentContainer.insertBefore(targetPane, sourcePane);
            parentContainer.insertBefore(sourcePane, temp);
            parentContainer.removeChild(temp);
        
            adjustPaneSizes();
        }
                
        

        function adjustPaneSizes() {
            Array.from(entryContent.querySelectorAll('.split-horizontal, .split-vertical')).forEach(container => {
                Array.from(container.children).forEach(pane => {
                    pane.style.flex = '1';
                });
            });
        }
                
                
        


        function moveEntry(index, direction) {
            if ((direction === 'up' && index > 0) || (direction === 'down' && index < entries.length - 1)) {
                var entryToMove = entries[index];
                entries.splice(index, 1);
                entries.splice(direction === 'up' ? index - 1 : index + 1, 0, entryToMove);
                current = direction === 'up' ? index - 1 : index + 1;
                updateEntryList();
                updateEntryContent();
                saveEntries();
            }
        }

        function updateEntryContent() {
            if (current >= 0) {
                entryContent.innerText = entries[current].content;
                entryContent.classList.add('active');
            } else {
                entryContent.innerText = "";
                entryContent.classList.remove('active');
            }
        }


        function createPane(entry, entryIndex) {
            var pane = document.createElement('div');
            pane.className = 'entry-pane';
            pane.dataset.entryId = entryIndex.toString();
            pane.draggable = true;
        
            var titleBar = document.createElement('div');
            titleBar.className = 'pane-title';
            titleBar.textContent = entry.title;
            pane.appendChild(titleBar);
        
            var contentDiv = document.createElement('div');
            contentDiv.contentEditable = true;
            contentDiv.innerHTML = entry.content;
            contentDiv.className = 'content-editable';
            pane.appendChild(contentDiv);
        
            pane.ondragstart = function(event) {
                event.dataTransfer.setData("pane-id", entryIndex.toString());
            };
                
            return pane;
        }
        
        
        function clearAndLoadEntry(entry) {
            entryContent.innerHTML = '';
            var entryIndex = entries.findIndex(e => e === entry);
            entryContent.appendChild(createPane(entry, entryIndex));
        }

        function splitPane(container, newPane) {
            if (container.children.length === 0) {
                container.appendChild(newPane);
            } else {
                var splitContainer = document.createElement('div');
                splitContainer.className = 'split-horizontal';
                splitContainer.appendChild(container.firstChild.cloneNode(true));
                splitContainer.appendChild(newPane);
        
                container.innerHTML = '';
                container.appendChild(splitContainer);
                
                Array.from(splitContainer.children).forEach(child => child.style.flex = '1');
            }
        }
        
        
        
        
        

        saveDbButton.addEventListener('click', function() {
            var content = entryContentStorage.value,
                blob = new Blob([content], {type: 'text/plain;charset=utf-8'}),
                a = document.createElement('a'),
                date = new Date(),
                dateString = date.toISOString().split('T')[0];

            var url = URL.createObjectURL(blob);
            a.href = url;
            a.download = 'notes_database_' + dateString + '.txt';
            document.body.appendChild(a);
            a.click();
            URL.revokeObjectURL(url);
            document.body.removeChild(a);
        });

        loadDbButton.addEventListener('click', function() {
            fileInput.click();
        });

        fileInput.addEventListener('change', function() {
            var file = fileInput.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    entryContentStorage.value = e.target.result;
                    loadEntries();
                };
                reader.readAsText(file);
            }
        });


        entryTitle.addEventListener("keyup", function(t) {
            if (t.keyCode === 13) {
                var title = entryTitle.value.trim();
                if (title) {
                    var newEntry = addNewEntry(title);
                    current = newEntry.id; 
                    updateEntryList();
                    clearAndLoadEntry(newEntry); 
                    entryTitle.value = "";
                }
            }
        });

      

        entryContent.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                document.execCommand('insertHTML', false, '<br><br>'); 
                event.preventDefault();
            }
        });

        saveButton.addEventListener('click', function() {
            if (current >= 0) {
                var content = entries[current].content,
                    title = entries[current].title || 'note',
                    blob = new Blob([content], {type: 'text/plain;charset=utf-8'}),
                    a = document.createElement('a');
        
                var url = URL.createObjectURL(blob);
                a.href = url;
                a.download = title + '.txt';
                document.body.appendChild(a);
                a.click();
                URL.revokeObjectURL(url);
                document.body.removeChild(a);
            }
        });

        entryContent.addEventListener('dragover', function(event) {
            event.preventDefault();
        });
        

        entryContent.addEventListener('drop', function(event) {
            event.preventDefault();
            var paneId = event.dataTransfer.getData("pane-id");
        
            if (paneId !== null) {
                var sourcePane = entryContent.querySelector(`[data-entry-id='${paneId}']`);
                var targetPane = event.target.closest('.entry-pane');
        
                if (sourcePane && targetPane && sourcePane !== targetPane) {
                    reorderPanes(sourcePane, targetPane);
                }
            }
        });
        
        
        
        
        
                
                        
        

        entryContent.addEventListener('input', function() {
            savePaneContent();
        });

        entryList.addEventListener('click', function(event) {
            var target = event.target.closest('.entry-item');
            if (target) {
                var index = target.getAttribute('data-index');
                clearAndLoadEntry(entries[index]);
            }
        });
        entryList.addEventListener('dragstart', function(event) {
            if (event.target.classList.contains('entry-item')) {
                var entryIndex = event.target.getAttribute('data-index');
                event.dataTransfer.setData("entry-index", entryIndex);
            }
        });        
        entryContent.addEventListener('drop', function(event) {
            event.preventDefault();
            var entryIndex = event.dataTransfer.getData("entry-index");
        
            if (entryIndex !== null) {
                var entry = entries[parseInt(entryIndex)];
                var newPane = createPane(entry, parseInt(entryIndex));
                splitPane(entryContent, newPane);
            }
        });
        
        
        setTimeout(loadEntries, 250);

        
        
    </script>
</body>
</html>
